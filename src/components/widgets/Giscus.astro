---

---

<div></div>
<script is:inline data-astro-rerun>
  console.log('giscus')
</script>

<script
  is:inline
  data-astro-rerun
  id="giscus-script"
  src="https://giscus.app/client.js"
  data-repo="lin-stephanie/astro-antfustyle-theme"
  data-repo-id="R_kgDOLylKbA"
  data-category="Giscus"
  data-category-id="DIC_kwDOLylKbM4Cpugn"
  data-mapping="title"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="noborder_light"
  data-lang="en"
  crossorigin="anonymous"
  async></script>

<!-- <div class="giscus"></div>
<script>
  import { FEATURES } from '~/config'

  const giscusThemeLight = `${location.origin}/giscus/light.css`
  const giscusThemeDark = `${location.origin}/giscus/dark.css`

  const giscusConfig = Array.isArray(FEATURES.giscus) && FEATURES.giscus[1]
  const giscusTemplateScript = document.createElement('script')

  console.log(FEATURES.giscus)

  Object.entries({
    ...giscusConfig,
    ...{
      id: 'giscus-script',
      src: 'https://giscus.app/client.js',
      crossOrigin: 'anonymous',
      // 'data-loading': 'lazy',
      async: '',
    },
  }).forEach(([key, value]) => {
    giscusTemplateScript.setAttribute(key, value)
  })

  const removeOldGiscus = () => {
    document
      .querySelectorAll('iframe.giscus-frame')
      .forEach((el) => el.remove())

    document
      .querySelectorAll('script#giscus-script')
      .forEach((el) => el.remove())
  }

  const addGiscusScript = (document: Document) => {
    if (!document.querySelector('.giscus')) return

    // Always clone a fresh <script> to ensure it executes again;
    // reused or previously inserted scripts won't run
    const clonedScript = giscusTemplateScript.cloneNode(
      true
    ) as HTMLScriptElement
    clonedScript.setAttribute(
      'data-theme',
      document.documentElement.classList.contains('dark')
        ? giscusThemeDark
        : giscusThemeLight
    )
    document.body.appendChild(clonedScript)
  }

  addGiscusScript(document)

  document.addEventListener('astro:before-swap', removeOldGiscus)
  document.addEventListener('astro:page-load', () => addGiscusScript(document))
</script> -->
